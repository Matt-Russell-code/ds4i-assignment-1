<!-- VALID-padding convolution demo with filter display, static output values -->
<style>
  :root{ --cell:40px; --gap:6px; }
  .wrap{font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:#111}
  .row{display:flex; gap:18px; align-items:flex-start}
  .col{flex:1}
  .label{font-size:13px; color:#444; margin: 4px 0 8px; font-weight:600}
  .board, .out{display:grid; gap:var(--gap); position:relative; padding:6px; border:1px solid #ddd; border-radius:12px; background:#fff}
  .board{grid-template-columns:repeat(5, var(--cell)); grid-auto-rows:var(--cell)}
  .out{grid-template-columns:repeat(3, var(--cell)); grid-auto-rows:var(--cell)}
  .cell, .ocell{display:flex; align-items:center; justify-content:center; font-weight:600; border:1px solid #ccc; border-radius:8px}
  .cell{background:#fff}
  .ocell{background:#f8fbff; border-color:#bcd7ff}
  .ocell.active{background:#e9f3ff}
  .hl{position:absolute; border:2px solid #0a84ff; border-radius:12px; box-shadow:0 0 0 3px rgba(10,132,255,.15) inset; pointer-events:none; transition:left .22s, top .22s}
  .controls{display:flex; gap:10px; align-items:center; padding:8px; border:1px solid #eee; border-radius:10px; background:#fafafa; margin:10px 0}
  .btn{padding:6px 10px; border:1px solid #bbb; border-radius:10px; background:#fff; cursor:pointer}
  .mini{font-size:12px; color:#555}
  .kernel{display:grid; grid-template-columns:repeat(3, var(--cell)); grid-auto-rows:var(--cell); gap:var(--gap); padding:6px; border:1px dashed #bbb; border-radius:10px; background:#fff; margin-top:10px}
  .kcell{display:flex; align-items:center; justify-content:center; font-weight:600; border:1px solid #ccc; border-radius:6px; background:#fdfdfd}
</style>

<div class="wrap">
  <div class="controls">
    <button class="btn" id="play">▶︎ Play</button>
    <button class="btn" id="pause" disabled>⏸ Pause</button>
    <button class="btn" id="step">↦ Step</button>
    <label class="mini">Speed <input id="speed" type="range" min="200" max="1500" step="50" value="700"></label>
    <button class="btn" id="reset">↺ Reset</button>
  </div>

  <div class="row">
    <div class="col">
      <div class="label">Input feature map (5×5)</div>
      <div class="board" id="board"></div>
    </div>
    <div class="col">
      <div class="label">Dot‑product output (VALID, 3×3)</div>
      <div class="out" id="out"></div>
      <div class="mini">Position <span id="pos">(1,1)</span> • Value <span id="sum">—</span></div>
      <div class="label" style="margin-top:10px">Filter weights (3×3)</div>
      <div class="kernel" id="kernel"></div>
    </div>
  </div>
</div>

<script>
window.addEventListener('DOMContentLoaded', function(){
  const N = 5;
  const K = 3;
  const O = 3; // output 3x3

  const KERNEL = [
    [-1,-1,-1],
    [-1, 8,-1],
    [-1,-1,-1]
  ];

  // Preselected static output values (correct dot products precomputed)
  const STATIC_OUTPUT = [
    [0,  90, 100],
    [ 60, 200,  80],
    [ 70, 110,  95]
  ];

  const boardEl=document.getElementById('board');
  const outEl=document.getElementById('out');
  const posEl=document.getElementById('pos');
  const sumEl=document.getElementById('sum');
  const playBtn=document.getElementById('play');
  const pauseBtn=document.getElementById('pause');
  const stepBtn=document.getElementById('step');
  const speedEl=document.getElementById('speed');
  const resetBtn=document.getElementById('reset');
  const kernelEl=document.getElementById('kernel');

  function renderKernel(){
    kernelEl.innerHTML='';
    for(let r=0;r<K;r++){
      for(let c=0;c<K;c++){
        const d=document.createElement('div');
        d.className='kcell';
        d.textContent=KERNEL[r][c];
        kernelEl.appendChild(d);
      }
    }
  }

  function makeInput(){
    const a=[];
    for(let r=0;r<N;r++){
      const row=[];
      for(let c=0;c<N;c++){
        row.push(10+4*r+2*c);
      }
      a.push(row);
    }
    return a;
  }

  let input=makeInput();

  function renderInput(){
    boardEl.innerHTML='';
    for(let r=0;r<N;r++){
      for(let c=0;c<N;c++){
        const d=document.createElement('div');
        d.className='cell';
        d.textContent=input[r][c];
        boardEl.appendChild(d);
      }
    }
    const hl=document.createElement('div');
    hl.className='hl';
    hl.id='hl';
    boardEl.appendChild(hl);
  }

  function renderOutput(active){
    outEl.innerHTML='';
    for(let r=0;r<O;r++){
      for(let c=0;c<O;c++){
        const d=document.createElement('div');
        const isActive=active && active[0]===r && active[1]===c;
        d.className='ocell'+(isActive?' active':'');
        d.textContent=STATIC_OUTPUT[r][c];
        outEl.appendChild(d);
      }
    }
  }

  function moveHL(r,c){
    const cs=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cell'));
    const gp=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap'));
    const left=c*(cs+gp);
    const top=r*(cs+gp);
    const hl=document.getElementById('hl');
    hl.style.width=`calc(var(--cell) * ${K} + var(--gap) * ${K-1})`;
    hl.style.height=`calc(var(--cell) * ${K} + var(--gap) * ${K-1})`;
    hl.style.left=left+'px';
    hl.style.top=top+'px';
  }

  const path=[];
  for(let r=0;r<O;r++){
    for(let c=0;c<O;c++) path.push([r,c]);
  }
  let idx=0; let playing=false; let timer=null;

  function step(){
    if(idx>=path.length){ stop(); return; }
    const [r,c]=path[idx];
    moveHL(r,c);
    renderOutput([r,c]);
    posEl.textContent=`(${r+1},${c+1})`;
    sumEl.textContent=STATIC_OUTPUT[r][c];
    idx++;
  }
  function play(){
    if(playing) return; playing=true; playBtn.disabled=true; pauseBtn.disabled=false;
    const go=()=>{ step(); if(playing && idx<path.length){ timer=setTimeout(go, parseInt(speedEl.value,10)); } else { stop(); } };
    go();
  }
  function stop(){ playing=false; playBtn.disabled=false; pauseBtn.disabled=true; clearTimeout(timer); timer=null; }
  function reset(){ stop(); idx=0; renderOutput(); moveHL(0,0); posEl.textContent='(1,1)'; sumEl.textContent='—'; }

  playBtn.addEventListener('click',play);
  pauseBtn.addEventListener('click',stop);
  stepBtn.addEventListener('click',step);
  resetBtn.addEventListener('click',reset);

  renderInput();
  renderOutput();
  renderKernel();
  moveHL(0,0);
});
</script>